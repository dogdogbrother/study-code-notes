# 问题模块

* 首先是有一对多的关系,就是一个用户可以提多个问题,但是每个问题只有一个提问者.
* 其次是多对多关系,一个问题有可能被赋予上多个话题,每个话题下也有多个问题.

## 用户-问题
其实也没什么好说的,问题的 schema 设计中,提问者的字段是 users 表的引用,指的一提的是 find 查询问题接口里面,除了要模糊搜索外,我们也有可能想通过用户名或是问题描述去查找问题(而不是只通过问题名去查找),怎么办呢?

mongoos提供了 `$or` 或者查询.(应该也有`$all`查询吧)

>说来惭愧,我曾经写搜索歌曲的时候查询了2遍数据库,然后forEach的形式去重..

```js
const q = new RegExp(ctx.query.q)
ctx.body = await Question.find({ $or: [{ title: q }, { description: q }] }).limit(...)...
```

## 问题-话题
其实也没啥好说的,互相引用就完事了..

***

# 答案模块

* 一个问题多个答案,一个用户多个答案.这都是一对多关系.
* 赞/踩答案是有互斥关系的,就是你已经点了赞,再点赞就是取消赞.或者你点了赞,又点了踩,不仅是踩还取消了赞.
* 收藏答案.

## 有着嵌套关系的接口
举个例子,我要在某个问题下搜索关键字为**女**的答案列表,接口应该是这样的:
```sh
api/questions/1/answers?q=女
```
>这样的一级嵌套前面已经看过了

如果我们想在某个问题下查找特定的答案,接口应该怎么写呢?
```sh
api/questions/1/answers/2
```
这样的2层嵌套有违直觉,似乎应该用 post 方法,把这两个 id 放到 body 中.但是RESTful风格就是这样的..

## 赞
假如你已经有了100个赞,我要是也赞一下就是101了,问题是我怎么更新数据呢?难道我要先查找此问题id下的数据,拿到点赞数再加1吗?当然这样是可以的,不过更优雅的方法是是 mongoose 提供的 `$inc` 工具.
```js
await Answer.findByIdAndUpdate(ctx.params.id,{ $inc: { voteCount: 1 } })
```
`voteCount`是点赞数,类型是`number`,这样操作就会自动增加 1 了.(如果想减1,就 -1 )