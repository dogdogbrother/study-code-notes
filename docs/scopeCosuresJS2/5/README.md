# 语法

## 语句的结果值
我们在Chrome浏览器的控制台里面输入内容,通常都先有一个`undefined`的输出,这是因为**语句都有一个结果值**.

举例在控制台中输入 `var a = 42` 会得到结果值 `undefined`，而非 42。a的值是42,但规范定义 `var` 的结果值是`undefined`。

怎么才能让他有值呢,代码举例:
```js
var b;
if (true) {
 b = 4 + 38;
}
```
42即最后一个语句 / 表达式 `b = 4 + 38` 的结果值。换句话说，代码块的结果值就如同一个**隐式的返回**，即返回最后一个语句的结果值。

可以使用万恶的 `eval(..)` 来获得结果值:
```js
var a, b;
a = eval( "if (true) { b = 4 + 38; }" );
a; // 42
```

ES7 规范有一项“do 表达式”（do expression）提案，类似下面这样：
```js
var a, b;
a = do {
 if (true) {
 b = 4 + 38; 
 }
};
a; // 42
```
`do { .. }` 表达式执行一个代码块（包含一个或多个语句），并且返回其中最后一个语句的结果值，然后赋值给变量 a。

和`eval`很像是吧,有可能就是为了代替`eval`吧(我猜的).

实际上,其目的是将语句当作表达式来处理（语句中可以包含其他语句），从而不需要将语句封装为函数再调用 `return` 来返回值。

## 表达式的副作用
看一段代码来:
```js
var a = 42;
var b = a++;
a; // 43
b; // 42
```
也许很多开发者会误以为变量 b 和 a 的值都是 43，这是因为没有完全理解 ++ 运算符的副作用何时产生。

++ 在前面时，如 `++a`，它的副作用（将 a 递增）产生在表达式返回结果值之前，而 `a++` 的副作用则产生在之后。所以我们`++a`的话,b就是43了.

如果我们一定要`a++`,可以使用`()`和`,`运算符配合上面说的语句结果值.`var b = (a++, b);`

```js
delete obj.a; // true
```
如果操作成功，`delete` 返回 `true`，否则返回 `false`。其副作用是属性被从对象中删除（或者单元从 array 中删除）。

我们看下利用赋值语句的副作用将两个 `if` 语句合二为一的例子,先看下原代码:
```js
function vowels(str) {
  var matches;
  if (str) {
    // 提取所有元音字母
    matches = str.match( /[aeiou]/g );
    if (matches) {
      return matches;
    } 
  }
}
vowels( "Hello World" ); // ["e","o","o"]
```
新代码:
```js
function vowels(str) {
  var matches;
  // 提取所有元音字母
  if (str && (matches = str.match( /[aeiou]/g ))) {
    return matches;
  }
}
vowels( "Hello World" ); // ["e","o","o"]
```
利用了()和结果值,让代码更简洁了一些.

## 上下文规则

### 大括号
1. 用大括号定义对象常量
```js
// 假定函数bar()已经定义
var a = {
 foo: bar()
};
```
{ .. } 被赋值给 a，因而它是一个对象常量。

2. 标签
如果将上例中的 var a = 去掉会发生什么情况呢？
```js
{
 foo: bar()
}
```
{ .. } 在这里只是一个普通的代码块。但是这里有个问题,既然不是对象了,为什么 `foo: bar()` 这样奇怪的语法为什么也合法呢？

这里涉及 JavaScript 中一个不太为人知（也不建议使用）的特性，叫作“标签语句”（labeled statement）。

3. JSON
JSON 的确是 JavaScript 语法的一个子集，但是 JSON 本身并不是合法的 JavaScript 语法。

JSON的key值是必须需要用""包起来的,`{"a":42}` 作为 JSON 值没有任何问题，但是在作为代码执行时会产生错误，因为它会被当作一个带有非法标签的语句块来执行。

`{"a":42}` 作为 JSON 值没有任何问题，但是在作为代码执行时会产生错误，因为它会被当作一个带有非法标签的语句块来执行。`foo({"a":42})` 就没有这个问题，因为 `{"a":42}` 在这里是一个传递给 `foo(..)` 的对象常量。

所以准确地说，JSON-P 能将 JSON 转换为合法的JavaScript 语法。